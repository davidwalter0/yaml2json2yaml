stages:
  - build
  
variables:
  gitlab_user: root
  gitlab_host: 128.107.15.211
  config_url:  http://ci-secret-config/slackurl
  secret_url:  http://ci-secret-config/kubeconfig
  deploy_yaml: http://ci-secret-config/deploy.yaml

build-yaml2json2yaml:
  stage: build
  script: 
    - export GOPATH=/go
    - export PATH=${GOPATH}/bin:${PATH}
    - echo "${HOSTNAME}" $(pwd) $(date)
    # - yum -y -q install make
    # - GO15VENDOREXPERIMENT=1 go get --ldflags '-s -w' github.com/tools/godep
    # - GO15VENDOREXPERIMENT=1 go install --ldflags '-s -w' github.com/tools/godep
    - go get github.com/davidwalter0/transform
    - ./build
    - rc=$?
    - step=build
    - bin/slack-status --step=${step} --gitlab-host=${gitlab_host} --gitlab-user=${gitlab_user} --slack-url=${config_url} --rc=${?}
    - echo bin/slack-status --step=${step} --gitlab-host=${gitlab_host} --gitlab-user=${gitlab_user} --slack-url=${config_url} --rc=${?}
    - ./dockerize
    - rc=$?
    - step=dockerize
    - echo bin/slack-status --step=${step} --gitlab-host=${gitlab_host} --gitlab-user=${gitlab_user} --slack-url=${config_url} --rc=${?}
    - bin/slack-status --step=${step} --gitlab-host=${gitlab_host} --gitlab-user=${gitlab_user} --slack-url=${config_url} --rc=${?}
  only:
    - master
  tags:
    - shell
    - ssh
